<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A320 Type Rating Review</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .message-box {
            transition: opacity 0.3s ease-in-out;
        }
        #activation-screen {
            background-color: #f0f4f8;
        }
        .course-body-bg {
            background: url('https://images.unsplash.com/photo-1540452981928-e4b780343a88?q=80&w=2070&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            position: relative;
        }
        .course-body-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.95);
            z-index: 1;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }
        .modal-close-button:hover {
            color: #374151;
        }
        .quiz-question {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .quiz-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .quiz-option input[type="radio"] {
            margin-right: 0.75rem;
        }
        .correct-answer {
            background-color: #d1fae5;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }
        .incorrect-answer {
            background-color: #fee2e2;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>

    <!-- Activation Screen -->
    <div id="activation-screen" class="flex flex-col items-center justify-center min-h-screen w-full p-4">
        <div class="w-full max-w-md text-center">
             <h1 class="text-4xl md:text-5xl font-extrabold text-blue-900 mb-8 tracking-wide">A320 TYPE RATING REVIEW</h1>
            <div class="p-8 space-y-8 bg-white rounded-2xl shadow-2xl">
                <div>
                    <h2 class="text-2xl font-bold text-center text-gray-800">Welcome</h2>
                    <p class="text-center text-gray-600 mt-2">Please enter your activation code to continue</p>
                    <form id="activation-form" class="mt-8 space-y-6">
                        <div class="rounded-md shadow-sm">
                            <div>
                                <label for="activation-code" class="sr-only">Subscription Activation Code</label>
                                <input id="activation-code" name="code" type="text" required
                                       class="relative block w-full px-3 py-4 text-center text-gray-900 placeholder-gray-500 border border-gray-300 rounded-md appearance-none focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-2xl tracking-[.5em]"
                                       placeholder="XXXXX" maxlength="5" autocapitalize="characters">
                            </div>
                        </div>
                        <p class="text-center text-sm text-gray-500">
                            If you don't have a code, contact us at
                            <a href="https://wa.me/966539301331" class="font-medium text-blue-600 hover:text-blue-500" target="_blank">+966 53 930 1331</a>
                        </p>
                        <div id="message-box" class="message-box text-center text-sm font-medium p-3 rounded-md opacity-0"></div>
                        <div>
                            <button type="submit"
                                    class="relative flex justify-center w-full px-4 py-3 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md group hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                                Verify and Enter
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Expired Screen (Initially Hidden) -->
    <div id="expired-screen" class="hidden flex flex-col items-center justify-center min-h-screen w-full p-4">
        <div class="w-full max-w-md text-center">
             <h1 class="text-4xl md:text-5xl font-extrabold text-red-600 mb-8 tracking-wide">Subscription Expired</h1>
            <div class="p-8 space-y-6 bg-white rounded-2xl shadow-2xl">
                <p class="text-lg text-gray-700">Your access to the A320 Type Rating Review has ended.</p>
                <p class="text-center text-md text-gray-600">
                    To renew your subscription, please contact us at:
                    <a href="https://wa.me/966539301331" class="block mt-2 font-bold text-xl text-blue-600 hover:text-blue-500" target="_blank">+966 53 930 1331</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Course Screen (Initially Hidden) -->
    <div id="course-screen" class="hidden min-h-screen w-full course-body-bg">
        <div class="relative z-20 w-full max-w-7xl mx-auto bg-white p-10 rounded-3xl shadow-2xl border border-blue-100 my-8">
            <h1 class="text-center text-5xl font-extrabold text-blue-900 mb-4 pb-5 border-b-4 border-blue-700 tracking-wide">A320 TYPE RATING REVIEW</h1>
             <div id="userInfo" class="text-center mb-8 p-3 bg-gray-100 rounded-lg shadow-inner">
                 <p id="userCodeDisplay" class="text-gray-700 font-mono text-sm"></p>
                 <p id="subscriptionStatus" class="text-sm text-gray-600 mt-1"></p>
            </div>
            <div class="bg-gradient-to-br from-teal-50 to-teal-100 p-8 mb-12 rounded-2xl shadow-xl border border-teal-200">
                <h2 class="text-center text-3xl font-bold text-teal-800 mb-8">Available A320 Lessons</h2>
                <div id="availableLessonsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl shadow-xl border border-blue-200 mt-12">
                <h2 class="text-center text-3xl font-bold text-blue-800 mb-8">Quiz Logbook</h2>
                <div id="quizLogbookContainer" class="space-y-4">
                    <p id="noQuizEntries" class="text-center text-gray-600">No quiz entries yet.</p>
                </div>
                <div class="mt-8 text-center">
                    <button onclick="resetCourseProgress()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                        Reset Course
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (for course screen) -->
    <div id="quizModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-button" onclick="closeQuizModal()">×</button>
            <h2 class="text-center text-3xl font-bold text-blue-800 mb-6">Review Quiz for: <span id="quizLessonTitle" class="text-purple-600"></span></h2>
            <div id="quizQuestionsContainer" class="mb-6"></div>
            <div id="quizResult" class="text-center text-2xl font-bold mb-4 hidden"></div>
            <button id="submitQuizBtn" onclick="submitQuiz()" class="mt-6 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Submit Quiz</button>
            <button id="goToNextLessonBtn" onclick="goToNextLesson()" class="mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full hidden">Go to Next Lesson ▶️</button>
            <button onclick="closeQuizModal()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Close Quiz</button>
        </div>
    </div>
    <div id="studyMaterialModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-button" onclick="closeStudyMaterialModal()">×</button>
            <h2 class="text-center text-3xl font-bold text-blue-800 mb-6">Study Material: <span id="studyMaterialTitle" class="text-teal-600"></span></h2>
            <div class="text-gray-800 text-base leading-relaxed">
                <h3 class="text-xl font-semibold text-gray-700 mt-4 mb-2">Detailed Content:</h3>
                <p id="studyMaterialFullContent" class="mb-4"></p>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Key Concepts:</h3>
                <ul id="studyMaterialKeyConcepts" class="list-disc list-inside mb-4 pl-4"></ul>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">External Resources:</h3>
                <ul id="studyMaterialExternalLinks" class="list-disc list-inside pl-4"></ul>
            </div>
            <div id="myStudyNotesSection" class="mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200 shadow-inner hidden">
                <h3 class="text-xl font-semibold text-blue-700 mb-4">My Study Notes:</h3>
                <textarea id="myStudyNotes" class="w-full p-4 border border-blue-300 rounded-md bg-white text-gray-800 min-h-[150px]" placeholder="Write your personal notes here..."></textarea>
                <button onclick="saveStudyNotes()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Save Notes</button>
            </div>
            <button id="startQuizFromStudyBtn" onclick="startQuizForCurrentLesson()" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Start Quiz</button>
            <button onclick="closeStudyMaterialModal()" class="mt-6 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Close</button>
        </div>
    </div>
    <div id="quizPlaybackModal" class="modal-overlay hidden">
         <div class="modal-content">
            <button class="modal-close-button" onclick="closeQuizPlaybackModal()">×</button>
            <h2 class="text-center text-3xl font-bold text-blue-800 mb-6">Quiz Review: <span id="playbackQuizLessonTitle" class="text-purple-600"></span></h2>
            <div id="playbackQuizQuestionsContainer" class="mb-6"></div>
            <div id="playbackQuizResult" class="text-center text-2xl font-bold mb-4"></div>
            <button onclick="closeQuizPlaybackModal()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md w-full">Close Review</button>
        </div>
    </div>

    <script>
        // --- Global State and Config (No Firebase) ---
        let userActivationCode = null;
        let lessonProgress = {};
        let quizLog = [];
        let currentLessonTopic = null;
        let currentQuizQuestions = [];
        
        const validCodes = [
            "4GYA5", "ZW7FP", "VD0P8", "G4NM5", "VC45R", "QN10D", "7J1RU", "22LCH", "PMCCO", "PZWVP", "4MRXP", "B1IRT", "F6SR1", "FBOMQ", "DAU07", "DUW0E", "E0SX4", "FHKHA", "V51H1", "SEKZP", "QBXQZ", "5WB7U", "X7DNH", "O73SN", "2TKQC", "KKJZB", "CF270", "27F1C", "ZDQD3", "H4EGU", "GVTXL", "M5GTF", "K403L", "KG764", "LBN8H", "1D4MI", "JA9HG", "3VENU", "KDUDQ", "BBQKU", "0LRMV", "4KTHL", "NZO1E", "3X1KN", "XXOUY", "MSZW7", "4GUVW", "QFQCG", "6VB4P", "JUOFI", "S3967", "Q4XEP", "WBPSB", "SFU0W", "R8T5E", "OSRAS", "JIN2G", "MJMEA", "NGKD2", "2EQ6E", "ZL2QL", "GB8L0", "J6097", "OJSNP", "CPELD", "MM4LZ", "ABRF5", "JA5FU", "HR6TP", "IHJA8", "4K3NB", "TGEQL", "2RGDO", "VHEH3", "6J6K5", "N95BH", "BUKZZ", "TLTE4", "XZ6SD", "HNEGS", "M6ISR", "L01HY", "TU1CW", "VBZZ6", "5YHLJ", "8DEM2", "E8P9G", "FFIIX", "ZG7SM", "K36GB", "N8Y13", "B66I2", "F167P", "A6X7P", "FDW9C", "5TJCQ", "NRQZ6", "QNDC2", "94OXA", "EE5SY", "OY4IT", "247WW", "9JTNY", "D3JZD", "52SNG", "P7DQQ", "4HS3E", "UXMYW", "887DA", "TCPGM", "G7HZA", "L3L4S", "UW85Q", "ZVSAF", "PTM2A", "JXFO6", "DF24C", "9JM4G", "9JJMW", "VX8AN", "UBGUT", "03BYM", "3BWFC", "6YQ0R", "S8WYK", "TEJXS", "WI4XT", "44C3A", "212ON", "HOPHT", "86IJR", "1Y12O", "LA6TI", "SCP41", "VMBFG", "8R0XH", "PQSQ3", "VL56E", "LDZ1A", "6DYEU", "F3MOX", "L2W4F", "L6EFA", "BOM7H", "FNGWG", "NQGHV", "KIISB", "6CRVL", "M3J4I", "UJ4RM", "6JLW0", "NZH9J", "KWHJD", "JL2WP", "F1NZU", "YLD5I", "SH3I6", "DLMPG", "F4Z7S", "0YX1W", "Q0SO1", "W780S", "KNKSL", "6N2WC", "HYHYY", "TWZ8O", "P4BE6", "AJGAL", "YZMLA", "0X7EM", "QW2K9", "LSUET", "5VH2F", "D0CTB", "XSUS4", "QXJX3", "DL8MD", "GGA99", "15935", "KSSTJ", "O0WNP", "H3DSG", "NUGL0", "CFO6Q", "25YJQ", "P15FJ", "QOQ9P", "IO01H", "1A54M", "H7Q75", "NBZVX", "7LW2R", "I21ST", "CDPHU", "79H6D", "RAKZL", "ZI0L5", "YCVZP", "9H92T", "3279L", "60YEW", "SQO3Y", "YTKXW", "QRQI6", "LZ0J8", "6OKP8", "YS1M3", "ITQQT", "QLTVH", "HAC9D", "G1AB1", "LG3PL", "UVLNS", "94PFN", "MCPQI", "GI5MH", "ZYQNE", "TTX3U", "6O3DK", "OQE3J", "JXEA9", "6L4R3", "3TJ8A", "4PH9Y", "PEBBT", "WE6QK", "B4U4R", "VXE69", "KBN8S", "53SPQ", "2B3KW", "R8E2W", "GJ6MC", "NQXG0", "CVUQO", "BJZ3L", "88GD8", "GV6T2", "7QU40", "LI66X", "QWI0P", "0L5EI", "PYW09", "GU3NL", "T49IV", "UZ63U", "L2JOA", "52VGU", "D082H", "UGPH8", "RKKK9", "8OKQR", "CKJIF", "UGW1D", "D54TV", "A1E92", "T7T2Q", "LD73M", "DVTYO", "UDCEL", "R1990", "DGL1R", "0U84X", "LTL05", "7ATBR", "BWIDE", "XE3V8", "NCL9I", "8GTFB", "K11IW", "AE3VO", "ZW51F", "W9U39", "BH366", "145FA", "OG95H", "H9VVS", "ICV95", "B6AHM", "KYR5A", "KKS3N", "T3QZ7", "DQ37F", "TYT0J", "6QUXD", "FB8MQ", "PMHDT", "UYVI6", "YY1H6", "H378O", "IWW85", "U8N1T", "HQ587", "AKTT2", "LXGNJ", "0AZ25", "V3LEY", "7WQGN", "OW1RU", "90HL9", "WU81I", "VJ5HG", "FJDAF", "DTOTZ", "D8QFP", "Q6JFL", "2QMO3", "S1361", "BK3B8", "VVBOD", "V5H4P", "2KMH2", "D03HB", "Z8KW3", "RZSJE", "763X5", "0R7FB", "KZS81", "GM693", "TKZZ6", "8UEUI", "KGYA6", "KLKF4", "N9D4D", "DGU6Y", "RQ4A9", "EUWSY", "ZHRCX", "P7QI5", "6NYGX", "ZSHRM", "9RQMT", "1Z5Q1", "W3O60", "IQ72S", "FF7WR", "C6O7H", "P6LUG", "A1Q36", "YB2Y3", "ZKWN2", "FY1FQ", "Q0CSW", "8DHTB", "678QN", "L47PX", "BG8NU", "X9TNA", "MNQDJ", "YEGUY", "TPF0U", "8ZEN9", "ITS8H", "XK3J5", "YC1MB", "N1RCM", "5QBES", "T022Q", "QK8XM", "YACQ4", "B2ITL", "UDKA3", "ZCX5O", "P1DPM", "1TXRC", "WX048", "MIILJ", "YHCDF", "T3NHD", "KAXG9", "1ZPNE", "FLZ3L", "162B1", "Q8X4V", "G34QZ", "H9L7N", "P4TWE", "LXBE3", "U5JO5", "QM1E7", "3LXUS", "CHQON", "AWM3R", "M4IUI", "JM6CL", "2IQWT", "ZILQV", "GCZUJ", "7FUTP", "3VB7Q", "QZKPC", "I8I6R", "E5V3N", "P3CL8", "EOCHS", "MOAMT", "I02RR", "EWW2Z", "3LUTX", "6U8AA", "X1X28", "WL6HP", "XOPSS", "IQQ8A", "ZEUTN", "Y1ZZD", "7E2QJ", "5GO0Y", "TZ4Y1", "OPGXF", "XYRC6", "AI4L7", "ZIHIQ", "EY9R1", "SLPQX", "WHHDX", "NJ5VZ", "59R53", "7UC2D", "0ZPM4", "6SSTK", "Q319N", "O3QPS", "UXZZV", "LAWFM", "4HSF1", "UNFBU", "865IB", "5MODK", "FQS8N", "3CGJF", "OQHWW", "ER578", "RU1Q9", "DE9W4", "8XEN6", "E9JKY", "MJKF4", "HMCIQ", "72UIH", "4KD3B", "HSIYS", "HGSIC", "35KAZ", "I6J8D", "51PS7", "XBA1C", "BOJ1I", "NZB2J", "6BH5I", "O0D78", "V4BLG", "MQEJE", "3WJXX", "C25RU", "FWNSD", "AS5LU", "UUVVH", "2736P", "GNDAG", "W7JVT", "ZGUCD", "OS0X4", "SS9OM", "UO2U3", "8DB6M", "4EJEQ", "0V54C", "0ERUP", "209MF", "O01CF", "FXP8M", "QMG61", "10OJO", "ISI9T", "AAGXZ", "TCAJ8", "PJ4IS", "PLQ4D", "665WY", "ZRP0X", "UWVF3", "FZKD9", "4BB5G", "RM7WV", "NGFPT", "J1Z0Y", "4QX8D", "V18SG", "0QBNY", "Q06KF", "05YCR", "13U9D", "GOPAJ", "XVV3W", "RZQTX", "WZCYR", "T0EHS", "XJQC1", "MCY9Z", "ZIRNU", "8DAZE", "PTXRI", "XO08S", "MBRYX", "PDVFZ", "9GHGY", "LQ4ID", "ZDNGP", "M30EY", "F2IMM", "3LZRY", "H7WDG", "9NN2C", "ZV4YF", "F5XNZ", "KA14K", "Q81O7", "GNMEG", "8S006", "5WC62", "E4NDM", "9PF70", "8PGJ7", "J6N12", "DCLFG", "U4II6", "Y1G7A", "S76TE", "HCJVM", "1KB7S", "07JOG", "JIA6L", "X24PB", "8ML1W", "PFIAN", "WS0JC", "HVX5Y", "CKLWI", "B7EXV", "Q2IN8", "2MSVY", "NXSAH", "3G8G6", "SESRD", "LCZW7", "4AOSB", "1BEAW", "TKKGL", "JY3US", "GZRNL", "B5FR7", "KVN8Z", "5H68P", "VSM2Y", "TI1Z5", "66S5T", "8JVV4", "MQDTE", "82O5V", "UAYUZ", "X2DQ2", "8W33H", "92YKN", "OHWDM", "9CX45", "69GLV", "DL4RB", "ARYYV", "4AFYW", "ZHKUL", "M1AN3", "499TP", "662EA", "7HV07", "VW9BO", "RN52F", "D9RI3", "LRT0B", "UO7Y4", "XMGD8", "R05R4", "WJXRV", "ASZIU", "3ASGM", "B1QOY", "FAK3L", "UL4WC", "VL6QB", "TMIT6", "13P0R", "WQKAK", "19IG6", "YHC0F", "ZBL41", "PBH3B", "5VVCR", "YE6LL", "0Q4W8", "RSN70", "JUQTW", "40XWY", "2I9C6", "2R0QD", "9U214", "BLRN2", "F2UQP", "32WTE", "9QTTG", "0TPSI", "9SLQ5", "IBWFN", "C56VF", "B65EP", "QMKZ3", "WWU17", "BPC4E", "RXEBL", "8Z3YD", "JR1PD", "5O2AF", "CXH3O", "2WH8K", "29CQS", "QBQTG", "114LY", "3D33Z", "PE4R4", "XOT2K", "VADYH", "KWNLW", "YS3DK", "4NQ1N", "D3A37", "PJW76", "XDHA1", "EXGYC", "A3O4B", "LZF76", "3M9UB", "10GI7", "OZN5U", "93W6P", "P9RWE", "VAGTN", "3E3C7", "LXJ6A", "5P10C", "BN44M", "1KOU2", "21WJ6", "2M5I3", "MHNU9", "D3SNO", "DDSWD", "3LMWV", "K2BIJ", "P2HZX", "Q9ONC", "7GO0M", "O9LYB", "WHMN8", "C1AN2", "05RS3", "AKGEA", "H24M0", "LZTJJ", "A1HDJ", "1BXZ7", "S63O4", "6I289", "BQ0M1", "SCO3I", "QEDP1", "0CPCN", "UP5IE", "AM119", "AGI4U", "I63NW", "P4UDS", "QVPTA", "4JIY7", "KQAHF", "M245O", "AGVG4", "GEO0J", "UODYK", "M5HIN", "2J1NS", "LLJ22", "8SIT8", "M0F09", "Q6KMY", "NURM1", "XWUOZ", "QWEP9", "PUPZ7", "TCIWI", "5KLOP", "JKECF", "78VYZ", "OAZUF", "0V8CL", "YCKYO", "B2RVM", "TAEN9", "XQU7S", "9L0DN", "61C1L", "ZOQF0", "U7GZO", "WYT5F", "6TVJH", "V65S1", "XFC5M", "F2Z0C", "GYQZF", "IW74W", "EY451", "4RWZW", "VRM3D", "N585J", "1GOKY", "102SZ", "8LJZC", "479TY", "WMLTJ", "JPHYX", "N7A1L", "FNFVN", "MBVXP", "38WA6", "I9VO3", "ZTU65", "03TKL", "A6H24", "L1G46", "JGZSR", "5PGID", "AKWJ3", "AVOTH", "6RQ6P", "IGUS8", "85BCR", "CHIPR", "D47XZ", "DLEUU", "92NNH", "1A820", "VU84X", "SFYB5", "BB05Q", "PE10I", "CBADE", "BHGKM", "H67Z4", "AHG3T", "FDV2P", "5LJOR", "WUSUQ", "6QC3U", "4L5L6", "YHPGA", "Y83M9", "3KA6L", "5UV1N", "6L98D", "NGMIH", "N56PG", "GVNK7", "A9Y2P", "9BEEA", "O11UA", "4VL1Q", "8VFR3", "HRVE9", "4RC8T", "5E92C", "MH0MY", "JBFHL", "IKVNX", "YXPTM", "YH0TO", "ZPU8Z", "RI0PY", "LK31H", "RKP7N", "O9SLC", "2XXTB", "RKRCP", "L95HN", "BX5MK", "4A1RG", "KXTYT", "RS1W8", "ELOPU", "JLU3E", "I3NS7", "VCDJK", "OAXZT", "7RPZN", "QMNKS", "PIX3U", "ZIKKL", "MSJW5", "N2URW", "IUFB1", "HQR4Z", "VQEQD", "QONDW", "ZVPSI", "BSS9G", "VKASA", "BNAMV", "CXD4P", "7XZ7P", "QS5UV", "7TMJE", "WNYNK", "DA6PK", "6U9PE", "8ETW7", "KEFLK", "FKSXK", "EU8MZ", "AOME2", "VPQ9V", "MM84A", "ERVOZ", "69Q9C"
        ];

        const airbusA320QuestionBank = [
            { topic: "Systems Overview", question: "What is the primary purpose of the ECAM system in the A320?", options: ["To manage cabin entertainment.", "To centralize aircraft monitoring and display warnings/cautions.", "To control the autopilot.", "To calculate fuel consumption."], correctAnswer: "To centralize aircraft monitoring and display warnings/cautions." },
            { topic: "Systems Overview", question: "Which component is responsible for providing air data and inertial reference information to the A320's systems?", options: ["Flight Management Guidance Computer (FMGC).", "Electronic Centralized Aircraft Monitoring (ECAM).", "Air Data Inertial Reference System (ADIRS).", "Autoflight System (AFS)."], correctAnswer: "Air Data Inertial Reference System (ADIRS)." },
            { topic: "Electrical System", question: "In the A320, what is the primary source of AC power during normal engine operation?", options: ["APU Generator.", "Ram Air Turbine (RAT).", "Integrated Drive Generators (IDGs).", "Batteries."], correctAnswer: "Integrated Drive Generators (IDGs)." },
            { topic: "Electrical System", question: "What automatically deploys to provide emergency hydraulic and electrical power in case of dual engine generator failure?", options: ["Emergency Landing Gear.", "Auxiliary Power Unit (APU).", "Ram Air Turbine (RAT).", "External Power Unit."], correctAnswer: "Ram Air Turbine (RAT)." },
            { topic: "Electrical System", question: "What is the function of the Static Inverter in the A320 electrical system?", options: ["Converts DC power to AC power for essential services.", "Generates primary AC power.", "Regulates battery charging.", "Provides external power connection."], correctAnswer: "Converts DC power to AC power for essential services." },
            { topic: "Electrical System", question: "Which bus is typically powered by the aircraft batteries in an emergency?", options: ["AC BUS 1.", "DC BUS 2.", "Essential AC BUS.", "Ground Service Bus."], correctAnswer: "Essential AC BUS." },
            { topic: "Fuel System", question: "How many main fuel tanks does the A320 typically have?", options: ["One central tank.", "Two wing tanks only.", "Two wing tanks and one center tank.", "Four wing tanks."], correctAnswer: "Two wing tanks and one center tank." },
            { topic: "Fuel System", question: "Is fuel jettison capability available on the Airbus A320?", options: ["Yes, on all variants.", "Only on long-range variants.", "No, it is not available.", "Only for emergency landing."], correctAnswer: "No, it is not available." },
            { topic: "Fuel System", question: "What is the primary method of fuel transfer from the outer to inner wing tanks?", options: ["Gravity feed.", "Transfer pumps.", "Engine suction.", "APU pumps."], correctAnswer: "Transfer pumps." },
            { topic: "Fuel System", question: "What is indicated by a 'FUEL L(R) TK LO LVL' ECAM message?", options: ["Fuel pump failure.", "Low fuel quantity in the respective tank.", "Fuel temperature is too high.", "Fuel is contaminated."], correctAnswer: "Low fuel quantity in the respective tank." },
            { topic: "Hydraulic System", question: "Name the three independent hydraulic systems of the A320.", options: ["Red, White, Blue.", "Green, Blue, Yellow.", "Alpha, Beta, Gamma.", "Left, Right, Center."], correctAnswer: "Green, Blue, Yellow." },
            { topic: "Hydraulic System", question: "What is the normal operating pressure of the A320 hydraulic systems?", options: ["1500 psi.", "2000 psi.", "3000 psi.", "5000 psi."], correctAnswer: "3000 psi." },
            { topic: "Hydraulic System", question: "Which hydraulic system is normally powered by an Electric Motor Pump (EMP)?", options: ["Green System.", "Blue System.", "Yellow System.", "All three systems."], correctAnswer: "Blue System." },
            { topic: "Hydraulic System", question: "What is the purpose of the Power Transfer Unit (PTU) in the A320?", options: ["To generate electrical power.", "To transfer hydraulic power between Green and Yellow systems.", "To pressurize the fuel tanks.", "To extend the landing gear."], correctAnswer: "To transfer hydraulic power between Green and Yellow systems." },
            { topic: "Flight Controls", question: "Which 'Law' in the A320 flight control system provides envelope protections to prevent exceeding aircraft limits?", options: ["Direct Law.", "Alternate Law.", "Mechanical Law.", "Normal Law."], correctAnswer: "Normal Law." },
            { topic: "Flight Controls", question: "What is the primary function of the ELAC (Elevator Aileron Computer) in Normal Law?", options: ["Rudder control.", "Engine thrust management.", "Aileron and elevator control, and pitch/roll computations.", "Landing gear retraction."], correctAnswer: "Aileron and elevator control, and pitch/roll computations." },
            { topic: "Flight Controls", question: "In Alternate Law, what happens to the flight envelope protections?", options: ["All protections are retained.", "Some protections are lost (e.g., angle of attack protection).", "Only speed protection remains.", "New protections are introduced."], correctAnswer: "Some protections are lost (e.g., angle of attack protection)." },
            { topic: "Flight Controls", question: "Which control surface is mechanically linked to the rudder pedals in all flight control laws?", options: ["Ailerons.", "Elevators.", "Rudder.", "Spoilers."], correctAnswer: "Rudder." },
            { topic: "Engines", question: "What system optimizes engine performance and manages thrust in the A320?", options: ["Engine Control Unit (ECU).", "Flight Management Guidance Computer (FMGC).", "Full Authority Digital Engine Control (FADEC).", "Automatic Thrust Control (ATC)."], correctAnswer: "Full Authority Digital Engine Control (FADEC)." },
            { topic: "Engines", question: "What is the primary indication of an engine fire on the ECAM?", options: ["Engine vibration.", "Fuel imbalance.", "FIRE warning and associated ECAM actions.", "Oil pressure low."], correctAnswer: "FIRE warning and associated ECAM actions." },
            { topic: "Engines", question: "What is the purpose of the Bleed Air System from the engines?", options: ["To provide thrust.", "To cool the engines.", "To supply air for air conditioning and anti-ice systems.", "To pressurize the hydraulic systems."], correctAnswer: "To supply air for air conditioning and anti-ice systems." },
            { topic: "Engines", question: "What does 'N1' refer to on the engine display?", options: ["Engine oil temperature.", "Low pressure compressor/fan speed.", "High pressure compressor speed.", "Engine exhaust gas temperature."], correctAnswer: "Low pressure compressor/fan speed." },
            { topic: "Landing Gear", question: "What is the emergency method for extending the landing gear on the A320?", options: ["Manual crank system.", "Electrical backup system.", "Gravity extension system.", "Hydraulic bypass."], correctAnswer: "Gravity extension system." },
            { topic: "Landing Gear", question: "Which system provides braking action on the main landing gear?", options: ["Pneumatic brakes.", "Electric brakes.", "Carbon brakes with anti-skid.", "Hydraulic brakes without anti-skid."], correctAnswer: "Carbon brakes with anti-skid." },
            { topic: "Landing Gear", question: "How is nose wheel steering primarily controlled on the ground?", options: ["Rudder pedals only.", "Side stick only.", "Rudder pedals and a tiller.", "Autopilot."], correctAnswer: "Rudder pedals and a tiller." },
            { topic: "Air Conditioning", question: "What are the units that condition bleed air before distributing it to the cabin?", options: ["Compressors.", "Packs.", "Turbines.", "Heat Exchangers."], correctAnswer: "Packs." },
            { topic: "Air Conditioning", question: "How is cabin pressure primarily controlled in the A320?", options: ["By adjusting engine thrust.", "By opening and closing outflow valves.", "By manually pumping air into the cabin.", "By external air supply."], correctAnswer: "By opening and closing outflow valves." },
            { topic: "Air Conditioning", question: "What is the purpose of the Ram Air Inlet in the air conditioning system?", options: ["To provide additional thrust.", "To cool the packs on the ground or in flight.", "To supply oxygen to the cabin.", "To pressurize the water tanks."], correctAnswer: "To cool the packs on the ground or in flight." },
            { topic: "Navigation", question: "What is the primary interface for flight crew to input and manage flight plans in the A320?", options: ["Control Column.", "Side stick only.", "Multi-Control Display Unit (MCDU).", "Overhead Panel."], correctAnswer: "Multi-Control Display Unit (MCDU)." },
            { topic: "Navigation", question: "Which system provides the A320 with its primary position and navigation data?", options: ["VOR/DME.", "ADF.", "GPS and ADIRS.", "Weather Radar."], correctAnswer: "GPS and ADIRS." },
            { topic: "Navigation", question: "What is the function of the Flight Management Guidance Computer (FMGC)?", options: ["Controls cabin lighting.", "Integrates navigation data and provides flight guidance.", "Manages landing gear operation.", "Monitors engine parameters only."], correctAnswer: "Integrates navigation data and provides flight guidance." },
            { topic: "Performance", question: "Which factor is NOT typically considered in A320 takeoff performance calculations?", options: ["Aircraft weight.", "Runway length.", "Pilot's favorite color.", "Wind conditions."], correctAnswer: "Pilot's favorite color." },
            { topic: "Performance", question: "What is V2 speed?", options: ["Minimum control speed.", "Takeoff safety speed.", "Stall speed.", "Approach speed."], correctAnswer: "Takeoff safety speed." },
            { topic: "Performance", question: "What is the primary purpose of FLEX temperature setting for takeoff?", options: ["To increase engine thrust.", "To reduce engine wear and tear.", "To calculate maximum takeoff weight.", "To determine landing distance."], correctAnswer: "To reduce engine wear and tear." },
            { topic: "Abnormal Procedures", question: "What is the general philosophy for ECAM actions on the A320?", options: ["Delay and Observe.", "Read and Do.", "Analyze and Decide.", "Consult ATC."], correctAnswer: "Read and Do." },
            { topic: "Abnormal Procedures", question: "Where are non-ECAM abnormal procedures typically found?", options: ["Aircraft Maintenance Manual.", "Quick Reference Handbook (QRH).", "Pilot's personal notes.", "Air Traffic Control instructions."], correctAnswer: "Quick Reference Handbook (QRH)." },
            { topic: "Abnormal Procedures", question: "What does a 'MASTER CAUTION' light indicate?", options: ["An immediate danger requiring urgent action.", "A serious system fault requiring crew awareness and appropriate action.", "A minor advisory message.", "Engine shutdown."], correctAnswer: "A serious system fault requiring crew awareness and appropriate action." },
            { topic: "Abnormal Procedures", question: "What is the first action for an 'ENG 1 FIRE' ECAM warning?", options: ["Increase thrust on engine 1.", "Shut down engine 2.", "Thrust Levers (TL) 1 (affected engine) - IDLE.", "Call ATC."], correctAnswer: "Thrust Levers (TL) 1 (affected engine) - IDLE." },
            { topic: "SOPs", question: "What is the primary purpose of Standard Operating Procedures (SOPs) in aviation?", options: ["To allow pilots to fly as they wish.", "To ensure consistency, safety, and efficiency.", "To make flights longer.", "To increase fuel consumption."], correctAnswer: "To ensure consistency, safety, and efficiency." },
            { topic: "SOPs", question: "During takeoff, what is the standard callout for reaching V1?", options: ["Rotate.", "V2.", "V1.", "Positive Climb."], correctAnswer: "V1." },
            { topic: "SOPs", question: "Who is primarily responsible for monitoring aircraft systems and communications during a normal flight?", options: ["Pilot Flying (PF).", "Pilot Monitoring (PM).", "Flight Attendant.", "Air Traffic Controller."], correctAnswer: "Pilot Monitoring (PM)." },
            { topic: "SOPs", question: "What is the 'CLEAN' configuration in the A320?", options: ["Flaps and slats extended, landing gear down.", "Flaps and slats retracted, landing gear up.", "Only flaps extended, landing gear up.", "Only landing gear down, flaps retracted."], correctAnswer: "Flaps and slats retracted, landing gear up." },
            { topic: "Warning Systems", question: "What is the highest priority warning level in the A320 ECAM system?", options: ["Level 1 (Amber).", "Level 2 (Amber).", "Level 3 (Red).", "Level 4 (Blue)."], correctAnswer: "Level 3 (Red)." },
            { topic: "Warning Systems", question: "What does the 'MASTER WARNING' light indicate?", options: ["A minor advisory.", "A system fault requiring immediate attention.", "A successful system test.", "Fuel low warning."], correctAnswer: "A system fault requiring immediate attention." },
            { topic: "Warning Systems", question: "What is the purpose of the 'Aural Warning' system?", options: ["To display system messages.", "To provide audible alerts for abnormal conditions.", "To control cabin announcements.", "To play music."], correctAnswer: "To provide audible alerts for abnormal conditions." },
            { topic: "Autoflight", question: "What does FMA stand for in the context of the A320 autoflight system?", options: ["Flight Management Automation.", "Flight Mode Annunciator.", "Fuel Management Advisory.", "Forward Movement Assistant."], correctAnswer: "Flight Mode Annunciator." },
            { topic: "Autoflight", question: "Which unit is primarily used by pilots to select autoflight modes?", options: ["MCDU.", "ECAM Control Panel.", "Flight Control Unit (FCU).", "Overhead Panel."], correctAnswer: "Flight Control Unit (FCU)." },
            { topic: "Autoflight", question: "What is the difference between 'managed' and 'selected' modes in the autoflight system?", options: ["Managed modes are manual, selected modes are automatic.", "Managed modes follow FMGC computations, selected modes follow pilot inputs on FCU.", "Managed modes are for takeoff, selected modes for landing.", "There is no difference."], correctAnswer: "Managed modes follow FMGC computations, selected modes follow pilot inputs on FCU." },
            { topic: "Operational Procedures", question: "What is the typical sequence of actions during a normal pre-flight procedure?", options: ["Engine start, taxi, takeoff.", "Cockpit preparation, external inspection, cabin preparation.", "Landing, shutdown, parking.", "Fueling, catering, cleaning."], correctAnswer: "Cockpit preparation, external inspection, cabin preparation." },
            { topic: "Operational Procedures", question: "When is a 'Go-Around' procedure typically initiated?", options: ["Immediately after takeoff.", "During cruise flight.", "When the approach is unstable or landing is not safe.", "After landing and taxiing to the gate."], correctAnswer: "When the approach is unstable or landing is not safe." },
            { topic: "Operational Procedures", question: "What is the purpose of the 'Before Start' checklist?", options: ["To confirm readiness for takeoff.", "To ensure the aircraft is configured for engine start and taxi.", "To check landing gear extension.", "To prepare for landing."], correctAnswer: "To ensure the aircraft is configured for engine start and taxi." },
            { topic: "APU", question: "Where is the APU located in the A320?", options: ["Under the left wing.", "In the nose section.", "In the tail cone.", "Under the fuselage."], correctAnswer: "In the tail cone." },
            { topic: "APU", question: "What is one of the primary functions of the APU on the ground?", options: ["To provide thrust for takeoff.", "To generate hydraulic pressure for landing gear.", "To provide pneumatic (bleed air) for engine starting and air conditioning.", "To control flight surfaces."], correctAnswer: "To provide pneumatic (bleed air) for engine starting and air conditioning." },
            { topic: "APU", question: "Can the APU be used in flight?", options: ["No, only on the ground.", "Yes, but only for hydraulic power.", "Yes, for electrical power and sometimes bleed air.", "Only during emergency descent."], correctAnswer: "Yes, for electrical power and sometimes bleed air." },
            { topic: "Fire Protection", question: "Which areas of the A320 typically have fire detection and extinguishing systems?", options: ["Only the cockpit.", "Engines, APU, cargo compartments, and lavatories.", "Only the passenger cabin.", "Landing gear bays."], correctAnswer: "Engines, APU, cargo compartments, and lavatories." },
            { topic: "Fire Protection", question: "What is the primary extinguishing agent used in the A320's engine fire extinguishing system?", options: ["Water.", "Foam.", "Halon.", "CO2."], correctAnswer: "Halon." },
            { topic: "Oxygen System", question: "What is the primary source of oxygen for the flight crew in the A320?", options: ["Chemical oxygen generators.", "Portable oxygen bottles.", "Dedicated oxygen cylinders.", "Cabin air recirculation."], correctAnswer: "Dedicated oxygen cylinders." },
            { topic: "Oxygen System", question: "At what cabin altitude do passenger oxygen masks automatically deploy?", options: ["8,000 feet.", "10,000 feet.", "14,000 feet.", "25,000 feet."], correctAnswer: "14,000 feet." },
            { topic: "Ice & Rain Protection", question: "Which areas of the A320 are typically protected by anti-ice systems?", options: ["Only the wings.", "Engine nacelles, wing leading edges, and air data probes.", "Only the windshield.", "Landing gear."], correctAnswer: "Engine nacelles, wing leading edges, and air data probes." },
            { topic: "Ice & Rain Protection", question: "What is the primary source of heat for the wing anti-ice system?", options: ["Electrical heaters.", "Hot bleed air from the engines.", "Hydraulic fluid.", "APU exhaust."], correctAnswer: "Hot bleed air from the engines." },
            { topic: "Communication Systems", question: "What is the primary radio used for voice communication with Air Traffic Control?", options: ["HF Radio.", "VHF Radio.", "SATCOM.", "ACARS."], correctAnswer: "VHF Radio." },
            { topic: "Communication Systems", question: "What is ACARS primarily used for?", options: ["Voice communication with passengers.", "Data link communication for operational messages.", "Weather radar display.", "Cabin entertainment control."], correctAnswer: "Data link communication for operational messages." },
            { topic: "General Systems", question: "What is the purpose of the 'Slats' and 'Flaps'?", options: ["To reduce drag during cruise.", "To increase lift and drag during takeoff and landing.", "To control aircraft pitch.", "To store fuel."], correctAnswer: "To increase lift and drag during takeoff and landing." },
            { topic: "General Systems", question: "What is the function of the 'Spoilers' on the A320?", options: ["To increase lift.", "To increase drag and reduce lift, primarily during landing and rejected takeoff.", "To control engine thrust.", "To steer the aircraft on the ground."], correctAnswer: "To increase drag and reduce lift, primarily during landing and rejected takeoff." },
            { topic: "General Systems", question: "What is the 'Green Dot' speed on the PFD?", options: ["Maximum operating speed.", "Best lift-to-drag ratio speed for a clean configuration.", "Stall speed.", "Takeoff safety speed."], correctAnswer: "Best lift-to-drag ratio speed for a clean configuration." },
            { topic: "General Systems", question: "What is the purpose of the 'Autobrake' system?", options: ["To manually apply brakes.", "To automatically apply brakes upon landing at a pre-selected deceleration rate.", "To prevent tire skidding during taxi.", "To assist with nose wheel steering."], correctAnswer: "To automatically apply brakes upon landing at a pre-selected deceleration rate." }
        ];

        const airbusA320StudyMaterialBank = {
            "Systems Overview": {
                fullContent: "The A320 is a highly integrated aircraft with complex systems designed for efficiency and safety. A systems overview covers the general architecture of its major components, including the flight deck layout, ECAM philosophy, primary flight controls, hydraulic systems, electrical systems, fuel system, engines, landing gear, air conditioning, and navigation systems. The Electronic Centralized Aircraft Monitoring (ECAM) system is central to aircraft monitoring, displaying warnings, cautions, and system information. The Air Data Inertial Reference System (ADIRS) is a key component providing essential air data (airspeed, altitude, vertical speed) and inertial reference (attitude, heading, position) information to various aircraft systems, including the Flight Management Guidance Computers (FMGCs). Understanding how these systems interact is fundamental for A320 pilots.",
                keyConcepts: ["Integrated aircraft design.", "ECAM central to system monitoring and warning display.", "ADIRS provides air data and inertial reference.", "Key systems: Flight Controls, Hydraulics, Electrical, Fuel, Engines, Landing Gear, Air Conditioning, Navigation.", "Interconnected systems for efficiency and safety.", "Fundamental understanding for pilots."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 01 - Aircraft General", url: "#" }, { text: "A320 CBT Module: Systems Introduction", url: "#" }],
                descriptionSummary: "A comprehensive overview of the A320's integrated systems, including flight deck, ECAM, ADIRS, and major aircraft components."
            },
            "Electrical System": {
                 fullContent: "The A320 electrical system is primarily an AC (Alternating Current) system, with DC (Direct Current) power derived from AC sources. It's designed for high reliability with multiple independent sources. Normal operation involves two Engine Integrated Drive Generators (IDGs), one on each engine, supplying the main AC BUSes (AC BUS 1 and AC BUS 2). An Auxiliary Power Unit (APU) Generator provides an alternative AC source on the ground or in flight, capable of supplying power to both main AC BUSes. In case of dual engine generator failure, the Ram Air Turbine (RAT) automatically deploys into the airstream to provide emergency hydraulic power to the Blue hydraulic system and electrical power to the Essential AC BUS via an emergency generator. The Static Inverter converts DC power from the aircraft batteries to AC power to supply the Essential AC STAT INV bus, ensuring critical AC loads are powered in emergencies. The aircraft batteries primarily power the DC ESS BUS and DC BAT BUS in emergency situations.",
                keyConcepts: ["Primary AC system, DC derived from AC.", "Two IDGs (Engine 1 & 2) for main AC power.", "APU Gen as alternative AC source (ground/flight).", "RAT for emergency hydraulic (Blue) and electrical (Essential AC BUS) power.", "Static Inverter converts DC to AC for essential services.", "Batteries power DC ESS BUS in emergencies.", "Automatic load shedding for essential services."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 24 - Electrical", url: "#" }, { text: "A320 CBT Module: Electrical", url: "#" }],
                descriptionSummary: "The A320 electrical system is primarily an AC system, designed for high reliability with multiple independent sources, ensuring essential services are maintained even under severe failure conditions, including RAT deployment and Static Inverter function."
            },
            "APU": {
                fullContent: "The Auxiliary Power Unit (APU) is a small gas turbine engine located in the tail cone of the A320. Its primary functions are to provide pneumatic (bleed air) power for engine starting and air conditioning on the ground, and electrical power (AC) on the ground or in flight, especially when main engines are off or for backup. It can be started using aircraft battery power or external power. The APU has its own dedicated fire detection and extinguishing system (APU Fire Loop) and various automatic shutdown protections to prevent damage. The APU Master Switch on the overhead panel is used to initiate the APU start sequence and to shut it down.",
                keyConcepts: ["Located in tail cone.", "Provides pneumatic (bleed air) for engine start and ground air conditioning.", "Provides electrical (AC) power on ground or as in-flight backup.", "Can operate in flight as backup electrical source.", "APU Fire Loop for fire detection.", "Automatic fire detection and shutdown features.", "APU Master Switch controls start/shutdown.", "APU GEN button connects generator to electrical system."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 49 - APU", url: "#" }, { text: "A320 CBT Module: APU", url: "#" }],
                descriptionSummary: "The APU provides pneumatic and electrical power for engine starting and air conditioning on the ground, and electrical backup in flight, with integrated fire detection and control systems."
            },
            "Hydraulic System": {
                fullContent: "The A320 has three independent hydraulic systems: Green, Blue, and Yellow. Each operates at a nominal pressure of 3000 psi and powers various aircraft systems like landing gear, flaps, slats, flight controls, and brakes. The Green and Yellow systems are primarily powered by engine-driven pumps (EDPs), while the Blue system is powered by an Electric Motor Pump (EMP). The Blue system's EMP ensures hydraulic power is available even without engines running or APU. An emergency generator (RAT) can power the Blue system in case of primary power loss. A Power Transfer Unit (PTU) can transfer hydraulic power between Green and Yellow systems in specific failure scenarios (e.g., if one engine's EDP fails, the PTU can use the pressure from the other system to power the affected system's components, without fluid transfer).",
                keyConcepts: ["Three independent systems: Green, Blue, Yellow.", "Operating pressure: 3000 psi.", "Green & Yellow: Engine-Driven Pumps (EDPs).", "Blue: Electric Motor Pump (EMP) - ensures power without engines/APU.", "RAT provides emergency power to Blue system.", "PTU for Green/Yellow power transfer (no fluid transfer)."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 29 - Hydraulics", url: "#" }, { text: "A320 CBT Module: Hydraulics", url: "#" }],
                descriptionSummary: "The A320 has three independent hydraulic systems (Green, Blue, Yellow) operating at 3000 psi, powering various aircraft systems, with EMP for Blue and PTU for Green/Yellow transfer."
            },
            "Fuel System": {
                fullContent: "The A320 fuel system consists of two wing tanks (left and right) and one center tank. Fuel is primarily fed by electric pumps to the engines. The system is designed for automatic fuel management to maintain center of gravity within limits throughout the flight. Fuel transfer between tanks (e.g., from outer to inner wing tanks) is automated via transfer pumps. Refueling can be done via a single point refueling panel located under the right wing. Various sensors monitor fuel quantity and temperature, and an automatic defueling system is also available. A 'FUEL L(R) TK LO LVL' ECAM message indicates a low fuel quantity in the respective tank. Importantly, fuel jettison capability is NOT available on the A320.",
                keyConcepts: ["Two wing tanks, one center tank.", "Electric pumps for engine feed.", "Automatic fuel management for Center of Gravity (CG).", "Automated fuel transfer via transfer pumps.", "Single point refueling.", "'FUEL L(R) TK LO LVL' ECAM message indicates low fuel.", "No fuel jettison capability."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 28 - Fuel", url: "#" }, { text: "A320 CBT Module: Fuel System", url: "#" }],
                descriptionSummary: "The A320 fuel system manages fuel distribution from wing and center tanks to engines, with automatic transfer and single-point refueling, and no jettison capability."
            },
            "Air Conditioning": {
                fullContent: "The A320 air conditioning system provides cabin pressurization, temperature control, and ventilation for both the cabin and cockpit. It uses bleed air from the engines or APU, which is then conditioned by two air conditioning units called 'Packs' before being distributed. The system maintains a comfortable environment for passengers and crew and ensures adequate oxygen levels at altitude by controlling cabin pressure. Cabin pressure is primarily controlled by opening and closing outflow valves, which regulate the amount of air leaving the cabin. The Ram Air Inlet provides external air to cool the packs on the ground or in flight. In case of loss of normal air conditioning, an Emergency Ram Air Inlet can supply fresh air to the cabin. The Cabin Pressure Controller (CPC) automatically regulates cabin pressure. The Cabin Attendant Panel (CAP) allows cabin crew to manage cabin systems like lighting, temperature, and interphone.",
                keyConcepts: ["Provides cabin pressurization, temperature control, ventilation.", "Uses bleed air from engines/APU.", "Air conditioned by 'Packs'.", "Cabin pressure controlled by outflow valves.", "Ram Air Inlet cools packs.", "Emergency Ram Air Inlet for fresh air backup.", "CPC automatically regulates cabin pressure.", "CAP for cabin system management by attendants."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 21 - Air Conditioning", url: "#" }, { text: "A320 CBT Module: Air Conditioning", url: "#" }],
                descriptionSummary: "The A320 air conditioning system uses bleed air from engines/APU and packs for cabin pressurization, temperature control, and ventilation, with automatic pressure regulation and emergency features."
            },
            "Flight Controls": {
                fullContent: "The A320 uses a sophisticated fly-by-wire flight control system. In Normal Law, the system provides full flight envelope protection, preventing the aircraft from exceeding structural or aerodynamic limits (e.g., stall, overspeed, excessive bank). The side stick is the primary control input for pitch and roll in Normal Law, with the ELAC (Elevator Aileron Computer) being primarily responsible for aileron and elevator control, along with pitch and roll computations. In Alternate Law, some protections are lost, such as angle of attack protection, and the aircraft can be flown closer to its limits. In Mechanical Law (a rare backup), only the rudder and horizontal stabilizer are mechanically linked to the pedals and trim wheel respectively. The rudder is mechanically linked to the rudder pedals in all flight control laws. Spoilers are used to increase drag and reduce lift, primarily during landing and rejected takeoff (Ground Spoilers) or in flight for descent/speed reduction (Speed Brakes).",
                keyConcepts: ["Fly-by-wire system.", "Normal Law: Full envelope protection (stall, overspeed, bank).", "Side stick controls pitch and roll in Normal Law.", "ELAC for aileron/elevator control and computations.", "Alternate Law: Some protections lost (e.g., AoA protection).", "Mechanical Law: Rudder and horizontal stabilizer mechanically linked.", "Rudder mechanically linked to pedals in all laws.", "Spoilers (Speed Brakes/Ground Spoilers) for drag/lift reduction."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 27 - Flight Controls", url: "#" }, { text: "A320 CBT Module: Flight Controls", url: "#" }],
                descriptionSummary: "The A320's fly-by-wire flight controls feature Normal, Alternate, and Mechanical Laws, providing envelope protections and precise control via side stick and mechanically linked rudder."
            },
            "Engines": {
                fullContent: "The A320 can be powered by either CFM56 (from CFM International) or IAE V2500 (from International Aero Engines) turbofan engines. Each engine is controlled by a Full Authority Digital Engine Control (FADEC) system, which is a computer that optimizes engine performance, manages thrust settings, and provides automatic engine starting sequences. FADEC also protects the engine from exceeding operational limits. Engine indications, such as N1 (Low pressure compressor/fan speed), EGT (Exhaust Gas Temperature), and fuel flow, are displayed on the ECAM. The Bleed Air System from the engines supplies hot, high-pressure air for air conditioning, cabin pressurization, and anti-ice systems. In case of an engine fire, the primary indication on the ECAM is a 'FIRE' warning with associated ECAM actions, typically starting with reducing thrust to idle. Engine reversers are used to slow down the aircraft after landing by redirecting engine exhaust forward.",
                keyConcepts: ["CFM56 or IAE V2500 turbofan engines.", "FADEC for engine control, optimization, and protection.", "Automatic starting and thrust management.", "ECAM displays N1, EGT, and other engine parameters.", "Bleed Air System for air conditioning and anti-ice.", "Primary engine fire indication: ECAM FIRE warning.", "Reversers slow aircraft after landing."],
                externalLinks: [{ text: "FCOM Vol 1, Chapters 70-80 - Engines", url: "#" }, { text: "A320 CBT Module: Engines", url: "#" }],
                descriptionSummary: "A320 engines (CFM56/IAE V2500) are FADEC-controlled for optimal performance, automatic starting, and thrust management, with ECAM integration and bleed air systems."
            },
            "Landing Gear": {
                fullContent: "The A320 has a retractable tricycle landing gear system, hydraulically operated by the Green hydraulic system. The main landing gear retracts inwards into the fuselage, while the nose landing gear retracts forwards. Shock absorption is provided by oleo-pneumatic struts. Steering on the ground is primarily controlled by rudder pedals (for small deflections) and a tiller (for larger deflections). Braking is achieved via carbon brakes on the main gear, which incorporate an advanced anti-skid system to prevent tire skidding during braking. The Brake Steering Control Unit (BSCU) manages both braking and nose wheel steering. Emergency extension is available via a gravity extension system, which uses gravity and aerodynamic forces to extend the gear if hydraulic power is lost. Gear doors are hydraulically operated and mechanically locked. The Brake Fan system is used to cool the main landing gear brakes after landing, especially after heavy braking.",
                keyConcepts: ["Retractable tricycle gear, Green hydraulic operation.", "Main gear retracts inwards, nose gear forwards.", "Oleo-pneumatic shock absorption.", "Steering via rudder pedals and tiller.", "Carbon brakes with anti-skid system.", "BSCU manages braking and nose wheel steering.", "Gravity extension for emergency.", "Brake Fan system for cooling brakes."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 32 - Landing Gear", url: "#" }, { text: "A320 CBT Module: Landing Gear", url: "#" }],
                descriptionSummary: "The A320's hydraulic landing gear system includes main and nose gear, oleo-pneumatic struts, steering, carbon brakes with anti-skid, and gravity extension for emergencies."
            },
            "Navigation": {
                fullContent: "The A320 navigation system relies heavily on the Flight Management Guidance Computer (FMGC), which integrates data from various sources including the Air Data Inertial Reference System (ADIRS) and Global Positioning System (GPS), as well as conventional radio aids (VOR/DME, ADF). The Multi-Control Display Unit (MCDU) is the primary interface for flight crew to input and manage flight plans, performance data, and navigation information. The system provides highly accurate position, guidance, and performance predictions for all phases of flight. The Navigation Display (ND) shows the aircraft's position relative to the flight plan, waypoints, and weather information, including data from the Weather Radar, which displays precipitation and turbulence in the flight path.",
                keyConcepts: ["FMGC is central navigation computer.", "Integrates ADIRS, GPS, radio aids.", "MCDU is primary crew interface for flight plans/data.", "Provides accurate position and guidance.", "ND displays flight plan and weather radar data.", "Weather Radar shows precipitation/turbulence."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 22 - Auto Flight / Flight Management", url: "#" }, { text: "A320 CBT Module: Navigation", url: "#" }],
                descriptionSummary: "The A320 navigation system, centered on the FMGC, integrates ADIRS, GPS, and radio aids, with MCDU as the primary interface for flight plan management and ND for spatial awareness and weather."
            },
            "Performance": {
                fullContent: "A320 performance calculations are critical for safe and efficient flight operations. They involve determining takeoff and landing distances, climb and cruise performance, and fuel consumption based on various factors like aircraft weight, atmospheric conditions (temperature, pressure altitude), runway length, and wind. The Flight Management Guidance Computer (FMGC) assists in these calculations, but pilots must understand the underlying principles and use performance tables/software. Key performance speeds include V1 (Takeoff Decision Speed), Vr (Rotation Speed), V2 (Takeoff Safety Speed - minimum safe speed after takeoff with one engine inoperative), Vapp (Approach Speed), and Vls (Lowest Selectable Speed - minimum speed for safe flight in current configuration, displayed on PFD as Green Dot). The primary purpose of FLEX temperature setting for takeoff is to reduce engine wear and tear by allowing a reduced thrust takeoff, while still meeting performance requirements.",
                keyConcepts: ["Calculations for takeoff, landing, climb, cruise.", "Affected by weight, weather, runway, wind.", "FMGC assists in calculations.", "Pilot understanding of principles is vital.", "Key speeds: V1, Vr, V2 (Takeoff Safety Speed), Vapp, Vls (Lowest Selectable Speed/Green Dot).", "FLEX temperature reduces engine wear during takeoff."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 03 - Performance", url: "#" }, { text: "A320 CBT Module: Performance", url: "#" }],
                descriptionSummary: "A320 performance calculations are crucial for safe operations, covering takeoff, landing, climb, and cruise, influenced by various factors, and utilizing key speeds like V2 and FLEX temperature."
            },
            "Abnormal Procedures": {
                fullContent: "Abnormal procedures on the A320 are primarily managed through the ECAM (Electronic Centralized Aircraft Monitoring) system. ECAM displays warnings (Level 3 - Red, requiring immediate action), cautions (Level 2 - Amber, requiring crew awareness and appropriate action), and advises on appropriate actions. The general philosophy for ECAM actions is 'READ AND DO', meaning pilots read the action from the ECAM screen and perform it immediately. A 'MASTER CAUTION' light indicates a serious system fault. Non-ECAM procedures, which are not automatically displayed by ECAM but require crew action, are found in the QRH (Quick Reference Handbook). For an 'ENG 1 FIRE' ECAM warning, the first action is typically to reduce Thrust Levers (TL) 1 (affected engine) to IDLE. Crew resource management (CRM) and effective communication are crucial during abnormal situations.",
                keyConcepts: ["Managed via ECAM system.", "ECAM displays warnings (Level 3 Red), cautions (Level 2 Amber), and actions.", "'READ AND DO' philosophy for ECAM actions.", "QRH for non-ECAM procedures.", "MASTER CAUTION indicates serious system fault.", "First action for 'ENG 1 FIRE' is TL 1 to IDLE.", "CRM and communication are vital."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 04 - Abnormal Procedures", url: "#" }, { text: "A320 QRH", url: "#" }],
                descriptionSummary: "A320 abnormal procedures are managed via ECAM, following a 'READ AND DO' philosophy for warnings and cautions, with QRH for non-ECAM actions, emphasizing CRM."
            },
            "SOPs": {
                fullContent: "Standard Operating Procedures (SOPs) are a set of standardized instructions and protocols that guide flight crew in performing their duties. They ensure consistency, safety, and efficiency in all phases of flight, from pre-flight checks to shutdown. Adherence to SOPs is fundamental for multi-crew coordination and reducing human error. During takeoff, the standard callout for reaching V1 (Takeoff Decision Speed) is 'V1'. The Pilot Monitoring (PM) is primarily responsible for monitoring aircraft systems, communications, and checklists during a normal flight, while the Pilot Flying (PF) manipulates the controls. The 'CLEAN' configuration refers to the aircraft state where flaps and slats are fully retracted, and the landing gear is up, optimized for cruise flight.",
                keyConcepts: ["Standardized instructions for flight crew.", "Ensures consistency, safety, and efficiency.", "Covers all phases of flight.", "Fundamental for multi-crew coordination and error reduction.", "Standard callout 'V1' at takeoff decision speed.", "PM monitors systems/comms, PF manipulates controls.", "'CLEAN' configuration: flaps/slats retracted, gear up."],
                externalLinks: [{ text: "A320 SOP Manual", url: "#" }, { text: "Company Operations Manual (OM-A)", url: "#" }],
                descriptionSummary: "A320 SOPs are standardized instructions guiding flight crew through all phases of flight, ensuring consistency and safety, defining roles and aircraft configurations."
            },
            "Warning Systems": {
                fullContent: "The A320 incorporates comprehensive warning systems to alert the crew to abnormal conditions. These include aural warnings (e.g., master caution/warning chime, altitude alert, 'Retard' callout), visual warnings (e.g., ECAM messages, master warning/caution lights, PFD indications), and tactile warnings (e.g., stick shaker for stall warning). Warnings are categorized by priority: Level 3 (Red) indicates an immediate danger requiring urgent action (e.g., 'MASTER WARNING' light, continuous repetitive chime), Level 2 (Amber) indicates a serious system fault requiring crew awareness and appropriate action (e.g., 'MASTER CAUTION' light, single chime), and Level 1 (Amber) indicates a low-priority advisory. The ECAM system is central to displaying and managing these alerts, guiding the crew through appropriate procedures. The 'GPWS FLAP 3' warning is a Ground Proximity Warning System alert related to the aircraft's configuration (flaps not in landing configuration) when close to the ground.",
                keyConcepts: ["Aural, visual, and tactile warnings.", "Warning priority levels: Level 3 (Red), Level 2 (Amber), Level 1 (Amber).", "ECAM central for display and management.", "MASTER WARNING light indicates immediate attention required.", "MASTER CAUTION light indicates serious system fault.", "Aural Warning system provides audible alerts.", "GPWS (Ground Proximity Warning System) provides alerts like 'FLAP 3'."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 31 - ECAM", url: "#" }, { text: "A320 CBT Module: Warning Systems", url: "#" }],
                descriptionSummary: "A320 warning systems alert crew to abnormal conditions via aural, visual, and tactile cues, categorized by priority levels, managed by the ECAM system, and include GPWS alerts."
            },
            "Autoflight": {
                fullContent: "The A320's Autoflight System consists of the Flight Management Guidance Computers (FMGCs) and the Flight Control Unit (FCU). It provides automatic flight control and guidance, including autopilot, autothrust, and flight director functions. Pilots select modes on the FCU (e.g., altitude, speed, heading), and the FMGC computes the necessary commands to achieve these selections or follow the flight plan. The Flight Mode Annunciator (FMA) on the PFD (Primary Flight Display) indicates the engaged and armed modes, which is crucial for mode awareness. The system offers various lateral (e.g., NAV, HDG) and vertical (e.g., CLB, DES, ALT) modes for different flight phases. The 'managed' mode means the FMGC computes the target speed/altitude/path based on the flight plan and performance, while 'selected' mode means the pilot inputs a specific value on the FCU. The Autothrust system automatically controls engine thrust to maintain selected speed/Mach or thrust limit. The Flight Directors on the PFD provide visual guidance cues for manual flight, indicating the required pitch and roll to follow a selected path or mode. The A320 also has an 'Autoland' capability, allowing the autopilot system to perform an automatic landing.",
                keyConcepts: ["FMGCs and FCU are core components.", "Provides autopilot, autothrust, flight director.", "Modes selected on FCU, displayed on FMA (Flight Mode Annunciator).", "Crucial for mode awareness.", "Managed vs. Selected modes: FMGC computation vs. pilot input.", "Autothrust automatically controls engine thrust.", "Flight Directors provide visual guidance cues.", "Autoland capability for automatic landings."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 22 - Auto Flight / Flight Management", url: "#" }, { text: "A320 CBT Module: Autoflight", url: "#" }],
                descriptionSummary: "The A320's Autoflight System (FMGCs, FCU) provides automatic flight control, guidance, autopilot, and autothrust functions, with FMA for mode awareness and Autoland capability."
            },
            "Operational Procedures": {
                fullContent: "Operational procedures encompass all standard and non-standard operations of the A320, from pre-flight planning to post-flight checks. This includes normal checklists (e.g., Before Start checklist to confirm aircraft configuration for engine start and taxi), taxi procedures, takeoff and landing techniques, cruise management, and specific procedures for various flight conditions (e.g., adverse weather, high altitude). Adherence to these procedures ensures safe, efficient, and compliant operations. They are typically detailed in the Operations Manual (OM) and Quick Reference Handbook (QRH). A 'Go-Around' procedure is typically initiated when the approach is unstable or landing is not safe, requiring a climb and re-attempt of the approach.",
                keyConcepts: ["Covers all phases from pre-flight to post-flight.", "Includes normal checklists (e.g., Before Start) and specific techniques.", "Ensures safe, efficient, and compliant operations.", "Detailed in OM and QRH.", "Go-Around initiated for unstable/unsafe approach."],
                externalLinks: [{ text: "Company Operations Manual (OM-A)", url: "#" }, { text: "A320 QRH", url: "#" }],
                descriptionSummary: "Operational procedures cover all standard and non-standard A320 operations, from pre-flight to post-flight, ensuring safe and efficient flights, including checklists and go-around procedures."
            },
            "Fire Protection": {
                fullContent: "The A320 is equipped with comprehensive fire detection and extinguishing systems to protect critical areas. These areas typically include the engines, Auxiliary Power Unit (APU), cargo compartments, and lavatories. The primary extinguishing agent used in the A320's engine fire extinguishing system is Halon. The APU also has its own fire loop for detection. In cargo compartments, fixed fire extinguishing bottles (Halon) are used. Smoke detectors are present in lavatories and cargo compartments, triggering warnings on the ECAM, such as a 'Cargo Smoke' warning indication if smoke is detected in a cargo compartment.",
                keyConcepts: ["Fire detection/extinguishing in engines, APU, cargo, lavatories.", "Halon is primary extinguishing agent for engines.", "APU Fire Loop for APU detection.", "Fixed Halon bottles for cargo compartments.", "'Cargo Smoke' warning indicates smoke in cargo."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 26 - Fire Protection", url: "#" }, { text: "A320 CBT Module: Fire Protection", url: "#" }],
                descriptionSummary: "The A320 has comprehensive fire detection and Halon-based extinguishing systems for engines, APU, cargo, and lavatories, with specific ECAM warnings."
            },
            "Oxygen System": {
                fullContent: "The A320 oxygen system provides oxygen for the flight crew, cabin crew, and passengers. The primary source of oxygen for the flight crew is dedicated oxygen cylinders, providing a continuous supply. For passengers, chemical oxygen generators are used, which are activated automatically when the cabin altitude reaches approximately 14,000 feet, causing the passenger oxygen masks to deploy from the overhead panels. Portable Oxygen Bottles (POBs) are also available in the cabin, typically near cabin crew stations and galleys, for first aid or emergency use by crew or passengers.",
                keyConcepts: ["Oxygen for flight crew, cabin crew, passengers.", "Flight crew: dedicated oxygen cylinders.", "Passengers: chemical oxygen generators.", "Passenger masks deploy automatically at 14,000 feet cabin altitude.", "POBs (Portable Oxygen Bottles) for first aid/emergency in cabin."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 35 - Oxygen", url: "#" }, { text: "A320 CBT Module: Oxygen System", url: "#" }],
                descriptionSummary: "The A320 oxygen system provides cylinders for flight crew and chemical generators for passengers (deploying at 14,000 ft), with POBs for portable use."
            },
            "Ice & Rain Protection": {
                fullContent: "The A320 is equipped with systems to prevent ice formation on critical surfaces. This includes anti-ice systems for engine nacelles, wing leading edges, and air data probes (like pitot tubes and angle of attack sensors). Wing and engine anti-ice systems use hot bleed air from the engines. The windshields are electrically heated. The aircraft also has windshield wipers and a rain repellent system to maintain visibility in precipitation.",
                keyConcepts: ["Anti-ice for engine nacelles, wings, probes.", "Hot bleed air for wing/engine anti-ice.", "Electrically heated windshields.", "Windshield wipers and rain repellent."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 30 - Ice and Rain Protection", url: "#" }],
                descriptionSummary: "Covers the A320's systems for preventing ice on critical surfaces and maintaining visibility in rain, using bleed air and electrical heating."
            },
            "Communication Systems": {
                fullContent: "The A320 has multiple communication systems for voice and data link. This includes VHF radios for primary communication with air traffic control, HF radios for long-range communication over oceans, and a SATCOM system for satellite communication. ACARS (Aircraft Communications Addressing and Reporting System) is used for data link messages between the aircraft and ground stations, such as weather information, flight plans, and maintenance data.",
                keyConcepts: ["VHF for primary ATC communication.", "HF for long-range communication.", "SATCOM for satellite link.", "ACARS for data link messages."],
                externalLinks: [{ text: "FCOM Vol 1, Chapter 23 - Communications", url: "#" }],
                descriptionSummary: "Details the A320's communication suite, including VHF, HF, SATCOM, and the ACARS data link system."
            },
            "General Systems": {
                fullContent: "This module covers several important general systems. Slats and Flaps are high-lift devices on the wings used to increase lift and drag for takeoff and landing. Spoilers are panels on the top of the wings used to increase drag and reduce lift. The 'Green Dot' speed, displayed on the Primary Flight Display (PFD), represents the best lift-to-drag ratio speed for a clean configuration. The Autobrake system automatically applies a pre-selected deceleration rate upon landing.",
                keyConcepts: ["Slats and Flaps for high lift.", "Spoilers for drag and lift reduction.", "Green Dot speed for optimal lift/drag.", "Autobrake for automatic landing deceleration."],
                externalLinks: [],
                descriptionSummary: "An overview of key general systems like slats, flaps, spoilers, Green Dot speed, and the autobrake system."
            },
            "Final Comprehensive Exam": {
                fullContent: "This is a comprehensive final exam covering all topics of the Airbus A320 Type Rating. It is designed to test your overall understanding and readiness across all systems and operational procedures. Successfully completing this exam indicates a strong grasp of the A320's complexities and prepares you for further practical training. A score of 80% or higher is required to pass.",
                keyConcepts: ["Covers all systems and operational procedures.", "Tests comprehensive knowledge and readiness.", "Requires a high level of understanding across all modules.", "Passing score is 80% or higher."],
                externalLinks: [],
                descriptionSummary: "A comprehensive final exam covering all topics of the Airbus A320 Type Rating, designed to test overall understanding and readiness. Passing score: 80%."
            }
        };
        
        const lessonOrder = [
            "Systems Overview", "Electrical System", "APU", "Hydraulic System", "Fuel System", "Air Conditioning",
            "Flight Controls", "Engines", "Landing Gear", "Navigation", "Autoflight", "Performance",
            "Warning Systems", "Abnormal Procedures", "SOPs", "Fire Protection", "Oxygen System",
            "Ice & Rain Protection", "Communication Systems", "General Systems", "Final Comprehensive Exam"
        ];


        // --- Activation Logic ---
        const activationForm = document.getElementById('activation-form');
        const codeInput = document.getElementById('activation-code');
        const messageBox = document.getElementById('message-box');

        activationForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const enteredCode = codeInput.value.trim().toUpperCase();

            if (validCodes.includes(enteredCode)) {
                messageBox.textContent = 'Activation successful! Loading course...';
                messageBox.classList.remove('bg-red-100', 'text-red-700');
                messageBox.classList.add('bg-green-100', 'text-green-700');
                messageBox.style.opacity = '1';
                
                setTimeout(() => {
                    document.getElementById('activation-screen').classList.add('hidden');
                    initializeCourse(enteredCode);
                }, 1500);

            } else {
                messageBox.textContent = 'Invalid activation code. Please try again.';
                messageBox.classList.remove('bg-green-100', 'text-green-700');
                messageBox.classList.add('bg-red-100', 'text-red-700');
                messageBox.style.opacity = '1';
            }
        });

        // --- Course Initialization and Logic ---
        function initializeCourse(activationCode) {
            userActivationCode = activationCode;
            document.getElementById('userCodeDisplay').textContent = `Activation Code: ${userActivationCode}`;
            document.getElementById('userCodeDisplay').classList.remove('hidden');

            // Load progress from localStorage
            const savedProgress = localStorage.getItem(`a320_progress_${userActivationCode}`);
            if (savedProgress) {
                lessonProgress = JSON.parse(savedProgress);
            } else {
                // Initialize for a new user/code
                lessonProgress = {};
                lessonProgress[lessonOrder[0]] = { completed: false, notes: "Welcome!", started: true };
                // Set the activation date for the first time
                lessonProgress.activationDate = new Date().toISOString();
            }
            
            const savedLog = localStorage.getItem(`a320_log_${userActivationCode}`);
            if(savedLog) {
                quizLog = JSON.parse(savedLog);
            } else {
                quizLog = [];
            }
            
            const isSubscriptionActive = updateSubscriptionTimer();

            if (isSubscriptionActive) {
                document.getElementById('course-screen').classList.remove('hidden');
                populateAvailableLessons();
                displayQuizLog();
            }
        }
        
        function saveProgressToLocalStorage() {
            localStorage.setItem(`a320_progress_${userActivationCode}`, JSON.stringify(lessonProgress));
            localStorage.setItem(`a320_log_${userActivationCode}`, JSON.stringify(quizLog));
        }

        function updateSubscriptionTimer() {
            const statusEl = document.getElementById('subscriptionStatus');
            if (!lessonProgress.activationDate) {
                statusEl.textContent = "Subscription not active.";
                return true; 
            }

            const startDate = new Date(lessonProgress.activationDate);
            const expiryDate = new Date(startDate);
            expiryDate.setDate(startDate.getDate() + 30);

            const today = new Date();
            const timeDiff = expiryDate.getTime() - today.getTime();
            const daysRemaining = Math.ceil(timeDiff / (1000 * 3600 * 24));

            const formattedExpiryDate = expiryDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

            if (daysRemaining > 0) {
                statusEl.innerHTML = `Your subscription expires in <span class="font-bold text-green-600">${daysRemaining}</span> days (on ${formattedExpiryDate}).`;
                return true; 
            } else {
                document.getElementById('activation-screen').classList.add('hidden');
                document.getElementById('course-screen').classList.add('hidden');
                document.getElementById('expired-screen').classList.remove('hidden');
                return false;
            }
        }
        
        function isLessonCompleted(lessonKey) {
            return lessonProgress[lessonKey] && lessonProgress[lessonKey].completed === true;
        }

        function isLessonUnlocked(lessonKey) {
            const lessonIndex = lessonOrder.indexOf(lessonKey);
            if (lessonIndex === -1) return false;
            if (lessonIndex === 0) return true;
            const previousLessonKey = lessonOrder[lessonIndex - 1];
            return isLessonCompleted(previousLessonKey);
        }
        
        function populateAvailableLessons() {
            const container = document.getElementById('availableLessonsContainer');
            container.innerHTML = ''; 

            lessonOrder.forEach(topicKey => {
                const material = airbusA320StudyMaterialBank[topicKey];
                if (!material) return;

                const summary = material.descriptionSummary || 'No description available.';
                const unlocked = isLessonUnlocked(topicKey);
                let buttonHtml = '';
                let cardClasses = 'bg-white p-6 rounded-lg shadow-md border border-gray-200 flex flex-col justify-between';

                if (unlocked) {
                    if (isLessonCompleted(topicKey)) {
                        cardClasses += ' border-green-400';
                        buttonHtml = `<button onclick="showStudyMaterial('${topicKey}')" class="mt-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow transition duration-300">Completed ✅ View</button>`;
                    } else {
                        const buttonText = topicKey === "Final Comprehensive Exam" ? "Start Final Exam" : "Start Studying";
                        buttonHtml = `<button onclick="showStudyMaterial('${topicKey}')" class="mt-auto bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-md shadow transition duration-300">${buttonText}</button>`;
                    }
                } else {
                    cardClasses += ' opacity-60';
                    buttonHtml = `<button onclick="unlockLessonWithPassword('${topicKey}')" class="mt-auto bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-md transition duration-300">Locked 🔒</button>`;
                }

                const lessonCard = document.createElement('div');
                lessonCard.className = cardClasses;
                lessonCard.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${topicKey}</h3>
                    <p class="text-gray-600 text-sm mb-4 flex-grow">${summary}</p>
                    ${buttonHtml}
                `;
                container.appendChild(lessonCard);
            });
        }

        window.unlockLessonWithPassword = function(lessonKey) {
            const password = prompt("To unlock, please pass the previous lesson's quiz or enter the developer password:");
            const BYPASS_PASSWORD = "1234";

            if (password === BYPASS_PASSWORD) {
                const lessonIndex = lessonOrder.indexOf(lessonKey);
                if (lessonIndex > 0) {
                    const previousLessonKey = lessonOrder[lessonIndex - 1];
                    
                    if (!lessonProgress[previousLessonKey]) {
                        lessonProgress[previousLessonKey] = {};
                    }
                    lessonProgress[previousLessonKey].completed = true;
                    lessonProgress[previousLessonKey].completionDate = new Date().toISOString().split('T')[0];
                    
                    saveProgressToLocalStorage();
                    populateAvailableLessons();
                    
                    alert(`Lesson "${lessonKey}" has been unlocked!`);
                }
            } else if (password !== null) {
                alert("Incorrect password.");
            }
        }

        window.showStudyMaterial = function(lessonTopic) {
            currentLessonTopic = lessonTopic;
            const modal = document.getElementById('studyMaterialModal');
            document.getElementById('studyMaterialTitle').textContent = lessonTopic;
            const material = airbusA320StudyMaterialBank[lessonTopic];

            if (material) {
                document.getElementById('studyMaterialFullContent').textContent = material.fullContent;
                const keyConceptsList = document.getElementById('studyMaterialKeyConcepts');
                keyConceptsList.innerHTML = '';
                material.keyConcepts.forEach(c => {
                    const li = document.createElement('li');
                    li.textContent = c;
                    keyConceptsList.appendChild(li);
                });
                const externalLinksList = document.getElementById('studyMaterialExternalLinks');
                externalLinksList.innerHTML = '';
                material.externalLinks.forEach(l => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="${l.url}" target="_blank" class="text-blue-600 hover:underline">${l.text}</a>`;
                    externalLinksList.appendChild(li);
                });
            }

            const completed = isLessonCompleted(lessonTopic);
            document.getElementById('myStudyNotesSection').classList.toggle('hidden', !completed);
            document.getElementById('startQuizFromStudyBtn').classList.toggle('hidden', completed);

            if (completed) {
                document.getElementById('myStudyNotes').value = (lessonProgress[lessonTopic] && lessonProgress[lessonTopic].notes) || '';
            }
            modal.classList.remove('hidden');
        }
        
        window.saveStudyNotes = function() {
            if (!currentLessonTopic) return;
            const notes = document.getElementById('myStudyNotes').value;
            if(!lessonProgress[currentLessonTopic]) {
                lessonProgress[currentLessonTopic] = {};
            }
            lessonProgress[currentLessonTopic].notes = notes;
            saveProgressToLocalStorage();
            alert('Notes Saved!');
        }

        window.startQuizForCurrentLesson = function() {
            if (!currentLessonTopic) return;
            closeStudyMaterialModal();
            showQuizModal(currentLessonTopic);
        }

        function showQuizModal(lessonTopic) {
            currentLessonTopic = lessonTopic;
            const quizModal = document.getElementById('quizModal');
            document.getElementById('quizLessonTitle').textContent = lessonTopic;
            const container = document.getElementById('quizQuestionsContainer');
            container.innerHTML = 'Loading questions...';

            document.getElementById('quizResult').classList.add('hidden');
            document.getElementById('submitQuizBtn').classList.remove('hidden');
            document.getElementById('goToNextLessonBtn').classList.add('hidden');

            let questionsToLoad = [];
            if (lessonTopic === "Final Comprehensive Exam") {
                const NUMBER_OF_EXAM_QUESTIONS = 60;
                questionsToLoad = [...airbusA320QuestionBank].sort(() => 0.5 - Math.random()).slice(0, NUMBER_OF_EXAM_QUESTIONS);
            } else {
                questionsToLoad = airbusA320QuestionBank.filter(q => q.topic === lessonTopic);
            }
            
            currentQuizQuestions = questionsToLoad;
            
            container.innerHTML = '';
            if (currentQuizQuestions.length > 0) {
                currentQuizQuestions.forEach((q, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'quiz-question';
                    questionDiv.innerHTML = `<p class="font-semibold text-lg mb-2">${qIndex + 1}. ${q.question}</p>`;
                    
                    const shuffledOptions = [...q.options].sort(() => 0.5 - Math.random());
                    shuffledOptions.forEach((option, oIndex) => {
                        const optionId = `q${qIndex}o${oIndex}`;
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'quiz-option';
                        optionDiv.innerHTML = `
                            <input type="radio" id="${optionId}" name="question${qIndex}" value="${option}" class="mr-2">
                            <label for="${optionId}" class="text-gray-800">${option}</label>
                        `;
                        questionDiv.appendChild(optionDiv);
                    });
                    container.appendChild(questionDiv);
                });
            } else {
                container.innerHTML = '<p>No quiz questions available for this topic yet.</p>';
                document.getElementById('submitQuizBtn').classList.add('hidden');
            }

            quizModal.classList.remove('hidden');
        }

        window.submitQuiz = function() {
            let score = 0;
            const totalQuestions = currentQuizQuestions.length;
            const userAnswers = [];
            let allAnswered = true;

            currentQuizQuestions.forEach((q, qIndex) => {
                const selectedOption = document.querySelector(`input[name="question${qIndex}"]:checked`);
                if (!selectedOption) allAnswered = false;
                userAnswers.push({
                    question: q.question,
                    options: q.options,
                    correctAnswer: q.correctAnswer,
                    selectedAnswer: selectedOption ? selectedOption.value : null
                });
            });

            if (!allAnswered) {
                alert('Please answer all questions.');
                return;
            }

            const quizQuestionsContainer = document.getElementById('quizQuestionsContainer');
            userAnswers.forEach((answer, qIndex) => {
                const questionDiv = quizQuestionsContainer.children[qIndex];
                questionDiv.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
                questionDiv.querySelectorAll('label').forEach(label => {
                    if (label.textContent === answer.correctAnswer) {
                        label.classList.add('correct-answer');
                    } else if (label.textContent === answer.selectedAnswer) {
                        label.classList.add('incorrect-answer');
                    }
                });
                if (answer.selectedAnswer === answer.correctAnswer) {
                    score++;
                }
            });

            const percentage = totalQuestions > 0 ? (score / totalQuestions) * 100 : 0;
            const resultEl = document.getElementById('quizResult');
            resultEl.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(1)}%)!`;
            resultEl.classList.remove('hidden');
            document.getElementById('submitQuizBtn').classList.add('hidden');

            const passed = percentage >= 80;
            
            quizLog.unshift({
                id: `log_${Date.now()}`,
                lesson: currentLessonTopic,
                date: new Date().toISOString().split('T')[0],
                score: score,
                totalQuestions: totalQuestions,
                passed: passed,
                questionsAttempted: userAnswers
            });

            if (passed) {
                if(!lessonProgress[currentLessonTopic]) {
                    lessonProgress[currentLessonTopic] = {};
                }
                lessonProgress[currentLessonTopic].completed = true;
                lessonProgress[currentLessonTopic].completionDate = new Date().toISOString().split('T')[0];
                document.getElementById('goToNextLessonBtn').classList.remove('hidden');
                alert(`Congratulations! You passed the quiz for "${currentLessonTopic}"!`);
            } else {
                alert(`Quiz failed. You need 80% to pass. Please review and try again.`);
            }
            
            saveProgressToLocalStorage();
            displayQuizLog();
            populateAvailableLessons();
        };

        function displayQuizLog() {
            const container = document.getElementById('quizLogbookContainer');
            container.innerHTML = '';

            if (quizLog.length === 0) {
                container.innerHTML = '<p id="noQuizEntries" class="text-center text-gray-600">No quiz entries yet.</p>';
                return;
            }

            quizLog.forEach((entry) => {
                const logEntryDiv = document.createElement('div');
                logEntryDiv.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col md:flex-row justify-between items-center';
                const statusClass = entry.passed ? 'text-green-700 font-semibold' : 'text-red-700 font-semibold';
                const statusText = entry.passed ? 'Passed' : 'Failed';
                const percentage = entry.totalQuestions > 0 ? ((entry.score / entry.totalQuestions) * 100).toFixed(1) : 0;

                logEntryDiv.innerHTML = `
                    <div class="text-gray-800 mb-2 md:mb-0 md:w-2/3">
                        <p class="font-bold text-lg">${entry.lesson}</p>
                        <p class="text-sm text-gray-600">Date: ${entry.date}</p>
                        <p class="text-sm text-gray-600">Score: ${entry.score}/${entry.totalQuestions} (${percentage}%) - <span class="${statusClass}">${statusText}</span></p>
                    </div>
                    <div class="md:w-1/3 flex justify-end">
                        <button onclick="showQuizPlayback('${entry.id}')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow">View Details</button>
                    </div>
                `;
                container.appendChild(logEntryDiv);
            });
        }

        window.showQuizPlayback = function(logId) {
            const quizAttempt = quizLog.find(log => log.id === logId);
            if (!quizAttempt) return;
            
            document.getElementById('playbackQuizLessonTitle').textContent = quizAttempt.lesson;
            const container = document.getElementById('playbackQuizQuestionsContainer');
            container.innerHTML = '';
            const percentage = quizAttempt.totalQuestions > 0 ? ((quizAttempt.score / quizAttempt.totalQuestions) * 100).toFixed(1) : 0;
            document.getElementById('playbackQuizResult').textContent = `Score: ${quizAttempt.score}/${quizAttempt.totalQuestions} (${percentage}%)`;

            quizAttempt.questionsAttempted.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<p class="font-semibold text-lg mb-2">${qIndex + 1}. ${q.question}</p>`;

                q.options.forEach(option => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option';
                    let labelClasses = 'text-gray-800 p-1 rounded';
                    let icon = '';

                    if (option === q.correctAnswer) {
                        labelClasses += ' correct-answer';
                        icon = ' ✅';
                    } else if (option === q.selectedAnswer) {
                        labelClasses += ' incorrect-answer';
                        icon = ' ❌';
                    }
                    optionDiv.innerHTML = `<span class="${labelClasses}">${option}${icon}</span>`;
                    questionDiv.appendChild(optionDiv);
                });
                container.appendChild(questionDiv);
            });

            document.getElementById('quizPlaybackModal').classList.remove('hidden');
        }
        
        window.resetCourseProgress = function() {
            const confirmation = confirm("Are you sure you want to reset all your progress? This action cannot be undone and will also reset your subscription timer.");
            if (confirmation) {
                // Clear local variables
                lessonProgress = {};
                quizLog = [];
                
                // Clear localStorage for the current user
                localStorage.removeItem(`a320_progress_${userActivationCode}`);
                localStorage.removeItem(`a320_log_${userActivationCode}`);
                
                // Hide the course and show the activation screen again
                document.getElementById('course-screen').classList.add('hidden');
                document.getElementById('activation-screen').classList.remove('hidden');
                
                alert("Your course has been reset. Please enter an activation code to start again.");
            }
        }

        window.closeQuizModal = () => document.getElementById('quizModal').classList.add('hidden');
        window.closeStudyMaterialModal = () => document.getElementById('studyMaterialModal').classList.add('hidden');
        window.closeQuizPlaybackModal = () => document.getElementById('quizPlaybackModal').classList.add('hidden');
        window.goToNextLesson = () => {
            closeQuizModal();
            const currentIndex = lessonOrder.indexOf(currentLessonTopic);
            if (currentIndex > -1 && currentIndex < lessonOrder.length - 1) {
                showStudyMaterial(lessonOrder[currentIndex + 1]);
            }
        };

    </script>
</body>
</html>




